var path=require("path"),potty=require("potty"),os=require("os"),fs=require("fs"),child_process=require("child_process"),sheriff=require("sheriff"),pkg=require("../package.json"),scheme=pkg.scheme,version=pkg.version;if(process.env.ELECTRON_RUN_AS_NODE){var __date__=function(){var e=function(e){return(10>e?"0":"")+e},r=new Date,o=r.getUTCFullYear();return o+=e(r.getUTCMonth()+1),o+=e(r.getUTCDate()),o+=e(r.getUTCHours()),o+=e(r.getUTCMinutes())},rain_path={root:path.resolve(os.homedir(),".rain")};rain_path.lockfile=path.resolve(rain_path.root,"singleton.lock"),rain_path.log={},rain_path.log.folder=path.resolve(rain_path.root,"logs"),rain_path.log.file=path.resolve(rain_path.log.folder,__date__()),fs.existsSync(rain_path.root)||fs.mkdirSync(rain_path.root),sheriff.lock(rain_path.lockfile).then(function(){if("development"===scheme){fs.existsSync(rain_path.log.folder)||fs.mkdirSync(rain_path.log.folder);var e=process.stdout.write;process.stdout.write=function(r){e.apply(this,arguments),fs.appendFileSync(rain_path.log.file,r)}}var r=new potty(path.resolve(process.env.HOME||process.env.HOMEPATH,".rain"),"https://rain.vg/releases/desktop-daemon/"+os.type().toLowerCase()+"-"+os.arch().toLowerCase()+"/"+scheme+"/package",{ELECTRON_RUN_AS_NODE:!1,log:console.log,version:version});r.on("shutdown",function(){process.exit()}),r.start()}),process.once("SIGINT",function(){process.exit()}).once("SIGTERM",function(){process.exit()})}else{process.env.ELECTRON_RUN_AS_NODE=!0;var child=child_process.spawn(process.argv[0],[__filename],{detached:!0,stdio:["ignore","ignore","ignore"]});child.unref(),setTimeout(function(){require("electron").app.exit(0)},1e4)}